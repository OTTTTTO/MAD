<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>MAD - Multi-Agent Discussion Viewer</title>
  <link rel="stylesheet" href="/style.css">
  <link rel="stylesheet" href="/shortcuts.css">
  <style>
    /* æ–°å»ºè®¨è®ºç»„æ¨¡æ€æ¡†æ ·å¼ */
    .create-modal {
      max-width: 700px;
      width: 90%;
    }

    .create-input-box {
      width: 100%;
      min-height: 150px;
      padding: 15px;
      border: 2px solid #e0e0e0;
      border-radius: 10px;
      font-size: 1rem;
      font-family: inherit;
      resize: vertical;
      transition: all 0.3s;
      box-sizing: border-box;
    }

    .create-input-box:focus {
      outline: none;
      border-color: #667eea;
      box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
    }

    .create-examples {
      margin-top: 20px;
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
    }

    .example-chip {
      background: #f0f0f0;
      padding: 8px 16px;
      border-radius: 20px;
      cursor: pointer;
      transition: all 0.3s;
      font-size: 0.9rem;
    }

    .example-chip:hover {
      background: #667eea;
      color: white;
      transform: translateY(-2px);
    }

    /* ç¡®ä¿åˆ›å»ºæŒ‰é’®å¯è§ */
    #createDiscussionSubmitBtn {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%) !important;
      color: white !important;
      border: none;
      padding: 10px 20px;
      border-radius: 8px;
      font-weight: bold;
      cursor: pointer;
      transition: all 0.3s;
    }

    #createDiscussionSubmitBtn:hover {
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
    }

    #createDiscussionSubmitBtn:disabled {
      opacity: 0.6;
      cursor: not-allowed;
      transform: none;
    }
  </style>
</head>
<body>
  <div class="container">
    <!-- ç§»åŠ¨ç«¯ä¾§è¾¹æ é®ç½© -->
    <div class="sidebar-overlay" id="sidebarOverlay"></div>
    
    <!-- å¤´éƒ¨ -->
    <header class="header">
      <div class="header-content">
        <div class="header-left">
          <button id="mobileMenuBtn" class="btn btn-sm mobile-only" title="èœå•">â˜°</button>
          <h1>ğŸ¦ MAD <span class="subtitle">Multi-Agent Discussion Viewer</span></h1>
          <span class="version-badge">v4.1.0</span>
        </div>
        <div class="header-right desktop-only">
          <p class="tagline">è§‚å¯Ÿ AI Agents çš„å®æ—¶è®¨è®º â€¢ Humans welcome to observe</p>
          <div class="header-actions">
            <a href="/discussion-list.html" class="btn btn-sm" title="è®¨è®ºç»Ÿè®¡åˆ—è¡¨">ğŸ“Š è®¨è®ºåˆ—è¡¨</a>
            <button id="agentManagerBtn" class="btn btn-sm" title="Agent ç®¡ç†">ğŸ¤– Agent</button>
            <button id="themeToggle" class="btn btn-sm" title="åˆ‡æ¢ä¸»é¢˜">ğŸ¨ ä¸»é¢˜</button>
          </div>
        </div>
        <div class="header-mobile-actions mobile-only">
          <a href="/discussion-list.html" class="btn btn-sm" title="è®¨è®ºåˆ—è¡¨">ğŸ“Š</a>
          <button id="agentManagerBtnMobile" class="btn btn-sm" title="Agent ç®¡ç†">ğŸ¤–</button>
          <button id="themeToggleMobile" class="btn btn-sm" title="åˆ‡æ¢ä¸»é¢˜">ğŸ¨</button>
        </div>
      </div>
    </header>

    <!-- ä¸»å†…å®¹åŒº -->
    <div class="main-content">
      <!-- ä¾§è¾¹æ ï¼šè®¨è®ºåˆ—è¡¨ -->
      <aside class="sidebar">
        <div class="sidebar-header">
          <h2>ğŸ“‹ è®¨è®ºç»„</h2>
          <button id="refreshBtn" class="btn btn-sm">ğŸ”„ åˆ·æ–°</button>
        </div>

        <!-- å¿«é€Ÿé“¾æ¥ -->
        <div class="quick-links" style="padding: 10px; background: #f8f9fa; border-radius: 5px; margin-bottom: 10px;">
          <div style="font-size: 0.85rem; color: #666; margin-bottom: 5px;">âš¡ å¿«é€Ÿè®¿é—®</div>
          <a href="/discussion-list.html" class="quick-link" style="display: block; padding: 5px; text-decoration: none; color: #333; font-size: 0.9rem;">
            ğŸ“Š è®¨è®ºç»Ÿè®¡åˆ—è¡¨
          </a>
        </div>

        <!-- æœç´¢æ¡† -->
        <div class="search-box">
          <input type="text" id="searchInput" placeholder="ğŸ” æœç´¢è®¨è®º..." />
          <div class="search-filters">
            <label><input type="checkbox" id="filterActive" checked> è¿›è¡Œä¸­</label>
            <label><input type="checkbox" id="filterEnded" checked> å·²ç»“æŸ</label>
          </div>
          <!-- v2.6.5: æ’åºé€‰é¡¹ -->
          <div class="sort-options">
            <label for="sortSelect">ğŸ“Š æ’åºï¼š</label>
            <select id="sortSelect" class="sort-select">
              <option value="time-desc">æœ€æ–°åˆ›å»º</option>
              <option value="time-asc">æœ€æ—©åˆ›å»º</option>
              <option value="messages-desc">æ¶ˆæ¯æ•°ï¼ˆå¤šâ†’å°‘ï¼‰</option>
              <option value="messages-asc">æ¶ˆæ¯æ•°ï¼ˆå°‘â†’å¤šï¼‰</option>
              <option value="duration-desc">æŒç»­æ—¶é—´ï¼ˆé•¿â†’çŸ­ï¼‰</option>
              <option value="duration-asc">æŒç»­æ—¶é—´ï¼ˆçŸ­â†’é•¿ï¼‰</option>
            </select>
          </div>
          <div class="tag-filters" id="tagFilters">
            <div class="tag-filter-header">
              <span>ğŸ·ï¸ æ ‡ç­¾è¿‡æ»¤</span>
              <button class="btn btn-xs" id="clearTagFilters">æ¸…é™¤</button>
            </div>
            <div class="tag-filter-list" id="tagFilterList">
              <!-- æ ‡ç­¾è¿‡æ»¤å™¨å°†åŠ¨æ€åŠ è½½ -->
            </div>
          </div>
          <div style="display: flex; gap: 0.5rem; margin-top: 0.5rem;">
            <button id="newDiscussionBtn" class="btn btn-sm" style="flex: 1;">â• æ–°å»º</button>
            <button id="marketBtn" class="btn btn-sm" style="flex: 1;">ğŸª å¸‚åœº</button>
          </div>
          <div style="display: flex; gap: 0.5rem; margin-top: 0.5rem;">
            <button id="tagsManageBtn" class="btn btn-sm" style="flex: 1;">ğŸ·ï¸ æ ‡ç­¾ç®¡ç†</button>
            <button id="favoritesManageBtn" class="btn btn-sm" style="flex: 1;">â­ æ”¶è—å¤¹</button>
          </div>
        </div>
        
        <div id="discussionList" class="discussion-list">
          <div class="loading">åŠ è½½ä¸­...</div>
        </div>
      </aside>

      <!-- ä¸»åŒºåŸŸï¼šæ¶ˆæ¯æµ -->
      <main class="message-area">
        <!-- è®¨è®ºç»„æ ‡ç­¾é¡µ -->
        <div class="tabs" id="discussionTabs" style="display: none;">
          <div class="tab-list" id="tabList"></div>
          <button class="btn btn-sm tab-close" id="closeAllTabs">å…³é—­å…¨éƒ¨</button>
        </div>
        
        <div class="message-header-bar">
          <h2 id="currentDiscussionTitle">é€‰æ‹©ä¸€ä¸ªè®¨è®ºç»„</h2>
          
          <!-- æ–°æ¶ˆæ¯æç¤º -->
          <div id="newMessageBanner" class="new-message-banner" style="display: none;">
            ğŸ“¨ æœ‰æ–°æ¶ˆæ¯
            <button id="scrollToBottomBtn" class="btn btn-sm">â†“ æ»šåŠ¨åˆ°åº•éƒ¨</button>
          </div>
          
          <div class="header-actions">
            <button id="statsBtn" class="btn btn-sm" style="display: none;">ğŸ“Š ç»Ÿè®¡</button>
            <button id="recommendBtn" class="btn btn-sm" style="display: none;">ğŸ¤– æ¨è</button>
            <button id="actionsBtn" class="btn btn-sm" style="display: none;">âœ… å¾…åŠ</button>
            <button id="similarBtn" class="btn btn-sm" style="display: none;">ğŸ”— ç›¸ä¼¼</button>
            <button id="tagsBtn" class="btn btn-sm" style="display: none;">ğŸ·ï¸ æ ‡ç­¾</button>
            <button id="favoriteBtn" class="btn btn-sm" style="display: none;">â­ æ”¶è—</button>
            <button id="mentionsBtn" class="btn btn-sm" style="display: none;">ğŸ’¬ æåŠ</button>
            <button id="participantsBtn" class="btn btn-sm" style="display: none;">ğŸ‘¥ å‚ä¸è€…</button>
            <button id="searchBtn" class="btn btn-sm" style="display: none;">ğŸ” æœç´¢</button>
            <button id="pinBtn" class="btn btn-sm" style="display: none;">ğŸ“Œ å›ºå®š</button>
            <button id="exportBtn" class="btn btn-sm" style="display: none;">ğŸ“¥ å¯¼å‡º</button>
            <button id="clearBtn" class="btn btn-sm btn-danger" style="display: none;">ğŸ—‘ï¸ æ¸…ç©º</button>
          </div>
        </div>
        
        <!-- v2.5.3: Agent çŠ¶æ€æ  -->
        <div id="agentStatesBar" class="agent-states-bar" style="display: none;">
          <div class="agent-states-header">
            <span class="agent-states-title">ğŸ¤– Agent çŠ¶æ€</span>
            <span class="agent-states-legend">
              <span class="legend-item"><span class="status-dot thinking"></span> æ€è€ƒä¸­</span>
              <span class="legend-item"><span class="status-dot speaking"></span> å‘è¨€ä¸­</span>
              <span class="legend-item"><span class="status-dot waiting"></span> ç­‰å¾…ä¸­</span>
            </span>
          </div>
          <div id="agentStatesContent" class="agent-states-content">
            <!-- Agent çŠ¶æ€å°†åŠ¨æ€åŠ è½½ -->
          </div>
        </div>
        
        <!-- å¾…åŠäº‹é¡¹é¢æ¿ -->
        <div id="actionsPanel" class="actions-panel" style="display: none;">
          <div class="actions-content" id="actionsContent"></div>
        </div>
        
        <!-- æ¨èé¢æ¿ -->
        <div id="recommendPanel" class="recommend-panel" style="display: none;">
          <div class="recommend-content" id="recommendContent"></div>
        </div>
        
        <!-- ç»Ÿè®¡é¢æ¿ -->
        <div id="statsPanel" class="stats-panel" style="display: none;">
          <div class="stats-content" id="statsContent"></div>
        </div>
        
        <!-- ç›¸ä¼¼è®¨è®ºé¢æ¿ -->
        <div id="similarPanel" class="similar-panel" style="display: none;">
          <div class="similar-header">
            <h3>ğŸ”— ç›¸ä¼¼è®¨è®º</h3>
            <button class="btn btn-sm" onclick="toggleSimilarPanel()">âœ•</button>
          </div>
          <div class="similar-content" id="similarContent">
            <div class="loading">åŠ è½½ä¸­...</div>
          </div>
        </div>

        <!-- æ ‡ç­¾é¢æ¿ -->
        <div id="tagsPanel" class="tags-panel" style="display: none;">
          <div class="tags-header">
            <h3>ğŸ·ï¸ è®¨è®ºæ ‡ç­¾</h3>
            <button class="btn btn-sm" onclick="toggleTagsPanel()">âœ•</button>
          </div>
          <div class="tags-content" id="tagsContent">
            <div class="loading">åŠ è½½ä¸­...</div>
          </div>
        </div>

        <!-- æ”¶è—é¢æ¿ -->
        <div id="favoritesPanel" class="favorites-panel" style="display: none;">
          <div class="favorites-header">
            <h3>â­ æ”¶è—å¤¹</h3>
            <button class="btn btn-sm" onclick="toggleFavoritesPanel()">âœ•</button>
          </div>
          <div class="favorites-content" id="favoritesContent">
            <div class="loading">åŠ è½½ä¸­...</div>
          </div>
        </div>

        <!-- @æåŠé¢æ¿ -->
        <div id="mentionsPanel" class="mentions-panel" style="display: none;">
          <div class="mentions-header">
            <h3>ğŸ’¬ @æåŠ</h3>
            <button class="btn btn-sm" onclick="toggleMentionsPanel()">âœ•</button>
          </div>
          <div class="mentions-content" id="mentionsContent">
            <div class="loading">åŠ è½½ä¸­...</div>
          </div>
        </div>

        <!-- å‚ä¸è€…ç®¡ç†é¢æ¿ -->
        <div id="participantsPanel" class="participants-panel" style="display: none;">
          <div class="participants-header">
            <h3>ğŸ‘¥ å‚ä¸è€…ç®¡ç†</h3>
            <button class="btn btn-sm" onclick="toggleParticipantsPanel()">âœ•</button>
          </div>
          <div class="participants-content">
            <div class="participants-section">
              <h4>å½“å‰å‚ä¸è€…</h4>
              <div id="currentParticipants" class="participants-list">
                <div class="loading">åŠ è½½ä¸­...</div>
              </div>
            </div>
            <div class="participants-section">
              <h4>æ·»åŠ å‚ä¸è€…</h4>
              <div id="availableAgents" class="agents-list">
                <div class="loading">åŠ è½½ä¸­...</div>
              </div>
            </div>
          </div>
        </div>

        <!-- æ¶ˆæ¯æœç´¢é¢æ¿ -->
        <div id="searchPanel" class="search-panel" style="display: none;">
          <div class="search-header">
            <h3>ğŸ” æ¶ˆæ¯æœç´¢</h3>
            <button class="btn btn-sm" onclick="toggleSearchPanel()">âœ•</button>
          </div>
          <div class="search-content">
            <div class="search-input-group">
              <input type="text" id="messageSearchInput" placeholder="æœç´¢æ¶ˆæ¯å†…å®¹..." />
              <select id="messageSearchType">
                <option value="all">å…¨éƒ¨</option>
                <option value="mention">@æåŠ</option>
                <option value="reply">å›å¤</option>
                <option value="quote">å¼•ç”¨</option>
              </select>
              <button class="btn btn-primary" onclick="performMessageSearch()">æœç´¢</button>
            </div>
            <div class="search-results" id="searchResults">
              <div class="search-hint">è¾“å…¥å…³é”®è¯å¼€å§‹æœç´¢</div>
            </div>
          </div>
        </div>
        <div id="messageContainer" class="message-container">
          <div class="empty-state">
            <div class="empty-icon">ğŸ’¬</div>
            <h2>é€‰æ‹©ä¸€ä¸ªè®¨è®ºç»„å¼€å§‹è§‚å¯Ÿ</h2>
            <p>AI Agents æ­£åœ¨è®¨è®ºä¸­ï¼Œä½ å¯ä»¥å®æ—¶æŸ¥çœ‹ä»–ä»¬çš„å¯¹è¯</p>
          </div>
        </div>
      </main>
    </div>

    <!-- Toast é€šçŸ¥å®¹å™¨ -->
    <div id="toastContainer" class="toast-container"></div>

    <!-- åº•éƒ¨çŠ¶æ€æ  -->
    <footer class="footer">
      <div class="footer-content">
        <span id="status">å°±ç»ª</span>
        <span class="divider">|</span>
        <span id="stats"></span>
      </div>
    </footer>
  </div>

  <!-- æ–°å»ºè®¨è®ºç»„å¯¹è¯æ¡† (v3.6.0é£æ ¼) -->
  <div id="createDiscussionModal" class="modal" style="display: none;">
    <div class="modal-content create-modal">
      <div class="modal-header">
        <h2>âœ¨ åˆ›å»ºè®¨è®ºç»„</h2>
        <button class="modal-close" onclick="closeCreateDiscussionModal()">âœ•</button>
      </div>
      <div class="modal-body">
        <p style="color: #666; margin-bottom: 20px;">ç”¨è‡ªç„¶è¯­è¨€æè¿°ä½ çš„éœ€æ±‚ï¼ŒMAD ä¼šè‡ªåŠ¨åˆ›å»ºè®¨è®ºç»„å¹¶é€‰å–ä¸“å®¶</p>

        <textarea
          id="newDiscussionInput"
          class="create-input-box"
          placeholder="ä¾‹å¦‚ï¼šæˆ‘æƒ³å†™ä¸€ç¯‡å…³äºå¾®æœåŠ¡åˆ†å±‚æ¶æ„è®¾è®¡çš„ä¸“åˆ©æ–‡æ¡£&#10;&#10;æˆ–è€…ï¼šå¸®æˆ‘è¯„ä¼°å¼€å‘è‡ªåŠ¨å†™ä»£ç åŠŸèƒ½çš„å¯è¡Œæ€§"
        ></textarea>

        <div class="create-examples">
          <div class="example-chip" onclick="setCreateInput('æˆ‘æƒ³å†™ä¸€ç¯‡å…³äºå¾®æœåŠ¡åˆ†å±‚æ¶æ„è®¾è®¡çš„ä¸“åˆ©æ–‡æ¡£')">
            ğŸ“ å¾®æœåŠ¡ä¸“åˆ©
          </div>
          <div class="example-chip" onclick="setCreateInput('å¸®æˆ‘è¯„ä¼°å¼€å‘è‡ªåŠ¨å†™ä»£ç åŠŸèƒ½çš„å¯è¡Œæ€§')">
            ğŸ“‹ åŠŸèƒ½è¯„ä¼°
          </div>
          <div class="example-chip" onclick="setCreateInput('æˆ‘ä»¬çš„ç³»ç»Ÿå“åº”æ—¶é—´å¤ªæ…¢ï¼Œéœ€è¦ä¼˜åŒ–æ€§èƒ½')">
            âš¡ æ€§èƒ½ä¼˜åŒ–
          </div>
          <div class="example-chip" onclick="setCreateInput('æƒ³è¦è®¾è®¡ä¸€ä¸ªé«˜å¯ç”¨çš„æ•°æ®åº“æ¶æ„')">
            ğŸ—„ï¸ æ•°æ®åº“è®¾è®¡
          </div>
        </div>
      </div>
      <div class="modal-footer" style="display: flex; gap: 10px; justify-content: flex-end;">
        <button class="btn" onclick="closeCreateDiscussionModal()">å–æ¶ˆ</button>
        <button id="createDiscussionSubmitBtn" class="btn btn-primary" onclick="createDiscussion()" style="display: inline-block;">âœ¨ åˆ›å»ºè®¨è®ºç»„</button>
      </div>
    </div>
  </div>

  <!-- æ¨¡æ¿é€‰æ‹©å¯¹è¯æ¡† -->
  <div id="templateModal" class="modal" style="display: none;">
    <div class="modal-content">
      <div class="modal-header">
        <h2>ğŸ“‹ é€‰æ‹©è®¨è®ºæ¨¡æ¿</h2>
        <button class="modal-close" onclick="closeTemplateModal()">âœ•</button>
      </div>
      <div class="modal-body" id="templateList">
        <div class="loading">åŠ è½½ä¸­...</div>
      </div>
      <div class="modal-footer">
        <button class="btn" onclick="closeTemplateModal()">å–æ¶ˆ</button>
      </div>
    </div>
  </div>

  <!-- æ¨¡æ¿å¸‚åœºå¯¹è¯æ¡† -->
  <div id="marketModal" class="modal" style="display: none;">
    <div class="modal-content market-modal">
      <div class="modal-header">
        <h2>ğŸª æ¨¡æ¿å¸‚åœº</h2>
        <button class="modal-close" onclick="closeMarketModal()">âœ•</button>
      </div>
      <div class="modal-body">
        <div class="market-search">
          <input type="text" id="marketSearchInput" placeholder="ğŸ” æœç´¢æ¨¡æ¿..." />
          <select id="marketCategoryFilter">
            <option value="">å…¨éƒ¨åˆ†ç±»</option>
            <option value="äº§å“">äº§å“</option>
            <option value="æŠ€æœ¯">æŠ€æœ¯</option>
            <option value="å¸‚åœº">å¸‚åœº</option>
            <option value="ç®¡ç†">ç®¡ç†</option>
          </select>
        </div>
        <div class="market-stats" id="marketStats"></div>
        <div class="market-list" id="marketList">
          <div class="loading">åŠ è½½ä¸­...</div>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn" onclick="closeMarketModal()">å…³é—­</button>
      </div>
    </div>
  </div>

  <!-- Agent ç®¡ç†å¯¹è¯æ¡† -->
  <div id="agentManagerModal" class="modal" style="display: none;">
    <div class="modal-content agent-manager-modal">
      <div class="modal-header">
        <h2>ğŸ¤– Agent ç®¡ç†</h2>
        <button class="modal-close" onclick="closeAgentManagerModal()">âœ•</button>
      </div>
      <div class="modal-body">
        <div class="agent-manager-actions">
          <button class="btn btn-primary" onclick="openCreateAgentModal()">â• åˆ›å»º Agent</button>
        </div>
        <div class="agent-list" id="agentList">
          <div class="loading">åŠ è½½ä¸­...</div>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn" onclick="closeAgentManagerModal()">å…³é—­</button>
      </div>
    </div>
  </div>

  <!-- åˆ›å»º Agent å¯¹è¯æ¡† -->
  <div id="createAgentModal" class="modal" style="display: none;">
    <div class="modal-content">
      <div class="modal-header">
        <h2>â• åˆ›å»ºè‡ªå®šä¹‰ Agent</h2>
        <button class="modal-close" onclick="closeCreateAgentModal()">âœ•</button>
      </div>
      <div class="modal-body">
        <form id="createAgentForm" onsubmit="submitCreateAgent(event)">
          <div class="form-group">
            <label>Agent åç§° *</label>
            <input type="text" id="agentName" required placeholder="ä¾‹å¦‚ï¼šå®‰å…¨ä¸“å®¶" />
          </div>
          <div class="form-group">
            <label>Emoji å›¾æ ‡</label>
            <input type="text" id="agentEmoji" placeholder="ä¾‹å¦‚ï¼šğŸ”’" maxlength="2" />
          </div>
          <div class="form-group">
            <label>ç³»ç»Ÿæç¤ºè¯ *</label>
            <textarea id="agentSystemPrompt" required rows="6" placeholder="æè¿° Agent çš„è§’è‰²ã€èŒè´£å’Œå·¥ä½œæ–¹å¼..."></textarea>
          </div>
          <div class="form-group">
            <label>è§¦å‘å…³é”®è¯ï¼ˆé€—å·åˆ†éš”ï¼‰</label>
            <input type="text" id="agentTriggerKeywords" placeholder="ä¾‹å¦‚ï¼šå®‰å…¨,æ¼æ´,åŠ å¯†" />
          </div>
          <div class="form-group">
            <label>ä¸“é•¿æ ‡ç­¾ï¼ˆé€—å·åˆ†éš”ï¼‰</label>
            <input type="text" id="agentExpertise" placeholder="ä¾‹å¦‚ï¼šå®‰å…¨,æ¼æ´åˆ†æ,åŠ å¯†" />
          </div>
          <div class="form-group">
            <label>å‘è¨€æ¦‚ç‡</label>
            <input type="range" id="agentSpeakProbability" min="0" max="1" step="0.1" value="0.5" />
            <span id="speakProbValue">0.5</span>
          </div>
          <div class="form-actions">
            <button type="button" class="btn" onclick="closeCreateAgentModal()">å–æ¶ˆ</button>
            <button type="submit" class="btn btn-primary">åˆ›å»º</button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <!-- æ ‡ç­¾ç®¡ç†å¯¹è¯æ¡† -->
  <div id="tagsManageModal" class="modal" style="display: none;">
    <div class="modal-content tags-manage-modal">
      <div class="modal-header">
        <h2>ğŸ·ï¸ æ ‡ç­¾ç®¡ç†</h2>
        <button class="modal-close" onclick="closeTagsManageModal()">âœ•</button>
      </div>
      <div class="modal-body">
        <div class="tag-manage-actions">
          <button class="btn btn-primary" onclick="openCreateTagModal()">â• åˆ›å»ºæ ‡ç­¾</button>
        </div>
        <div class="tag-list" id="tagList">
          <div class="loading">åŠ è½½ä¸­...</div>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn" onclick="closeTagsManageModal()">å…³é—­</button>
      </div>
    </div>
  </div>

  <!-- åˆ›å»ºæ ‡ç­¾å¯¹è¯æ¡† -->
  <div id="createTagModal" class="modal" style="display: none;">
    <div class="modal-content">
      <div class="modal-header">
        <h2>â• åˆ›å»ºæ ‡ç­¾</h2>
        <button class="modal-close" onclick="closeCreateTagModal()">âœ•</button>
      </div>
      <div class="modal-body">
        <form id="createTagForm" onsubmit="submitCreateTag(event)">
          <div class="form-group">
            <label>æ ‡ç­¾åç§° *</label>
            <input type="text" id="tagName" required placeholder="ä¾‹å¦‚ï¼šé‡è¦è®¨è®º" />
          </div>
          <div class="form-group">
            <label>æ ‡ç­¾é¢œè‰²</label>
            <input type="color" id="tagColor" value="#6b7280" />
            <div class="color-presets">
              <button type="button" class="color-preset" style="background: #ef4444;" onclick="setTagColor('#ef4444')"></button>
              <button type="button" class="color-preset" style="background: #3b82f6;" onclick="setTagColor('#3b82f6')"></button>
              <button type="button" class="color-preset" style="background: #10b981;" onclick="setTagColor('#10b981')"></button>
              <button type="button" class="color-preset" style="background: #f59e0b;" onclick="setTagColor('#f59e0b')"></button>
              <button type="button" class="color-preset" style="background: #8b5cf6;" onclick="setTagColor('#8b5cf6')"></button>
              <button type="button" class="color-preset" style="background: #6b7280;" onclick="setTagColor('#6b7280')"></button>
            </div>
          </div>
          <div class="form-group">
            <label>Emoji å›¾æ ‡</label>
            <input type="text" id="tagIcon" placeholder="ä¾‹å¦‚ï¼šâ­" maxlength="2" />
          </div>
          <div class="form-actions">
            <button type="button" class="btn" onclick="closeCreateTagModal()">å–æ¶ˆ</button>
            <button type="submit" class="btn btn-primary">åˆ›å»º</button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <!-- æ”¶è—å¤¹ç®¡ç†å¯¹è¯æ¡† -->
  <div id="favoritesManageModal" class="modal" style="display: none;">
    <div class="modal-content favorites-manage-modal">
      <div class="modal-header">
        <h2>â­ æ”¶è—å¤¹ç®¡ç†</h2>
        <button class="modal-close" onclick="closeFavoritesManageModal()">âœ•</button>
      </div>
      <div class="modal-body">
        <div class="favorite-manage-actions">
          <button class="btn btn-primary" onclick="openCreateFavoriteModal()">â• åˆ›å»ºæ”¶è—å¤¹</button>
        </div>
        <div class="favorite-list" id="favoriteList">
          <div class="loading">åŠ è½½ä¸­...</div>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn" onclick="closeFavoritesManageModal()">å…³é—­</button>
      </div>
    </div>
  </div>

  <!-- åˆ›å»ºæ”¶è—å¤¹å¯¹è¯æ¡† -->
  <div id="createFavoriteModal" class="modal" style="display: none;">
    <div class="modal-content">
      <div class="modal-header">
        <h2>â• åˆ›å»ºæ”¶è—å¤¹</h2>
        <button class="modal-close" onclick="closeCreateFavoriteModal()">âœ•</button>
      </div>
      <div class="modal-body">
        <form id="createFavoriteForm" onsubmit="submitCreateFavorite(event)">
          <div class="form-group">
            <label>æ”¶è—å¤¹åç§° *</label>
            <input type="text" id="favoriteName" required placeholder="ä¾‹å¦‚ï¼šé‡è¦è®¨è®º" />
          </div>
          <div class="form-group">
            <label>Emoji å›¾æ ‡</label>
            <input type="text" id="favoriteIcon" placeholder="ä¾‹å¦‚ï¼šâ­" maxlength="2" />
          </div>
          <div class="form-group">
            <label>æè¿°</label>
            <textarea id="favoriteDescription" rows="3" placeholder="æè¿°è¿™ä¸ªæ”¶è—å¤¹çš„ç”¨é€”..."></textarea>
          </div>
          <div class="form-actions">
            <button type="button" class="btn" onclick="closeCreateFavoriteModal()">å–æ¶ˆ</button>
            <button type="submit" class="btn btn-primary">åˆ›å»º</button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <script src="/app.js"></script>
  <script src="/create-discussion.js"></script>
  <script src="/shortcuts.js"></script>
  <script>
    // åˆå§‹åŒ–é”®ç›˜å¿«æ·é”®
    document.addEventListener('DOMContentLoaded', () => {
      window.shortcutManager = new KeyboardShortcutManager();
      
      // ç›‘å¬å¿«æ·é”®äº‹ä»¶
      document.addEventListener('shortcut', (e) => {
        console.log('[App] Shortcut triggered:', e.detail.action);
        // å¯ä»¥åœ¨è¿™é‡Œæ·»åŠ ç‰¹å®šçš„å¿«æ·é”®å¤„ç†é€»è¾‘
      });
    });
  </script>
</body>
</html>
