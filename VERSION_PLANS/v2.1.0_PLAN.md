# MAD v2.1.0 开发计划

**计划时间：** 2026-02-02
**目标版本：** v2.1.0
**前一版本：** v2.0.0

---

## 🎯 版本目标

v2.1.0 将在 v2.0.0 的基础上继续增强功能，重点关注：

1. **讨论导出增强** - 支持更多导出格式
2. **Agent 市场** - 社区分享和下载自定义 Agent
3. **讨论标签系统** - 更好的组织和分类
4. **讨论收藏夹** - 快速访问重要讨论

---

## 📋 功能清单

### 1. 讨论导出增强
- [ ] PDF 导出
  - 生成格式化的 PDF 文档
  - 包含讨论历史、统计信息
  - 支持自定义样式
- [ ] HTML 导出
  - 生成独立的 HTML 文件
  - 可在浏览器中查看
  - 包含交互式元素
- [ ] CSV 导出
  - 导出消息列表为 CSV
  - 便于数据分析
- [ ] 导出模板
  - 自定义导出格式
  - 选择导出内容

### 2. Agent 市场
- [ ] Agent 分享
  - 导出自定义 Agent 为 JSON
  - 上传到本地市场
  - Agent 元数据（名称、描述、标签）
- [ ] Agent 浏览和搜索
  - Agent 列表页面
  - 按分类过滤
  - 搜索功能
- [ ] Agent 下载和安装
  - 一键下载 Agent
  - 预览 Agent 配置
  - 安装到本地
- [ ] Agent 评分和评论
  - 星级评分
  - 用户评论
  - 使用统计

### 3. 讨论标签系统
- [ ] 标签创建和管理
  - 创建自定义标签
  - 标签颜色和图标
  - 标签分组
- [ ] 标签应用
  - 为讨论添加多个标签
  - 标签建议（基于内容）
  - 批量打标签
- [ ] 标签过滤
  - 按标签过滤讨论
  - 多标签组合查询
  - 标签云视图
- [ ] 标签统计
  - 标签使用频率
  - 标签趋势分析

### 4. 讨论收藏夹
- [ ] 收藏功能
  - 一键收藏讨论
  - 收藏夹分类
  - 收藏备注
- [ ] 快速访问
  - 侧边栏收藏夹
  - 快捷键支持
  - 收藏搜索
- [ ] 收藏管理
  - 创建收藏夹分组
  - 重命名和删除
  - 导入/导出收藏

---

## 🔧 技术实现

### PDF 导出

使用 `pdfkit` 或 `puppeteer` 生成 PDF：

```javascript
async function exportToPDF(discussionId) {
  const discussion = getDiscussion(discussionId);

  // 使用 pdfkit
  const doc = new PDFDocument();
  doc.fontSize(20).text(discussion.topic);

  discussion.messages.forEach(msg => {
    doc.fontSize(12).text(`${msg.role}: ${msg.content}`);
  });

  doc.end();
  return doc;
}
```

### Agent 市场

扩展 Agent 自定义功能，添加市场：

```javascript
{
  "market": {
    "agents": [
      {
        "id": "market-agent-001",
        "name": "Python 专家",
        "description": "专注于 Python 开发和最佳实践",
        "author": "Community",
        "downloads": 123,
        "rating": 4.8,
        "config": { /* Agent 配置 */ }
      }
    ]
  }
}
```

### 标签系统

```javascript
class DiscussionTag {
  constructor(id, name, color, icon) {
    this.id = id;
    this.name = name;
    this.color = color;
    this.icon = icon;
    this.createdAt = Date.now();
    this.usageCount = 0;
  }
}

// 应用标签
async function tagDiscussion(discussionId, tagIds) {
  const discussion = getDiscussion(discussionId);
  discussion.tags = tagIds;
  await saveDiscussion(discussion);
}
```

### 收藏夹

```javascript
{
  "favorites": [
    {
      "id": "fav-001",
      "name": "重要讨论",
      "discussions": ["disc-001", "disc-002"],
      "createdAt": "2026-02-02"
    }
  ]
}
```

---

## 📂 文件结构

```
mad/
├── exporters/
│   ├── pdf.js              # PDF 导出器
│   ├── html.js             # HTML 导出器
│   └── csv.js              # CSV 导出器
├── agents/
│   ├── custom/             # 自定义 Agent
│   └── market.json         # Agent 市场
├── tags/
│   ├── index.json          # 标签索引
│   └── tag-001.json        # 标签数据
├── favorites/
│   └── index.json          # 收藏夹
├── web/
│   ├── server.js           # 添加导出、标签、收藏 API
│   └── public/
│       ├── index.html      # 添加 UI
│       ├── app.js          # 添加前端逻辑
│       └── style.css       # 添加样式
└── VERSION_PLANS/
    └── v2.1.0_PLAN.md      # 本文件
```

---

## 🚀 开发步骤

### 阶段 1：讨论导出增强（2-3 小时）
1. ✅ 安装依赖（pdfkit、puppeteer）
2. ✅ 实现 PDF 导出器
3. ✅ 实现 HTML 导出器
4. ✅ 实现 CSV 导出器
5. ✅ 在 web/server.js 中添加导出 API
6. ✅ 在前端添加导出选项
7. ✅ 测试所有导出格式
8. ✅ 提交代码：`feat: v2.1.0 - 讨论导出增强`

### 阶段 2：Agent 市场（2-3 小时）
1. ✅ 创建 Agent 市场数据结构
2. ✅ 预置社区 Agent（5+ 个）
3. ✅ 实现 Agent API（上传、下载、评分）
4. ✅ 创建 Agent 市场 UI
5. ✅ 实现 Agent 分享功能
6. ✅ 测试功能
7. ✅ 提交代码：`feat: v2.1.0 - Agent 市场`

### 阶段 3：讨论标签系统（2-3 小时）
1. ✅ 设计标签数据结构
2. ✅ 实现标签 API（CRUD）
3. ✅ 创建标签管理 UI
4. ✅ 实现标签过滤功能
5. ✅ 添加标签建议算法
6. ✅ 测试功能
7. ✅ 提交代码：`feat: v2.1.0 - 讨论标签系统`

### 阶段 4：讨论收藏夹（1-2 小时）
1. ✅ 设计收藏夹数据结构
2. ✅ 实现收藏 API
3. ✅ 创建收藏夹 UI
4. ✅ 实现快速访问功能
5. ✅ 测试功能
6. ✅ 提交代码：`feat: v2.1.0 - 讨论收藏夹`

### 阶段 5：整合和发布（30 分钟）
1. ✅ 更新 package.json 到 v2.1.0
2. ✅ 更新 README.md 版本历史
3. ✅ 整理代码注释
4. ✅ 最终测试
5. ✅ 提交：`chore: bump version to v2.1.0`
6. ✅ 推送到 GitHub

### 阶段 6：规划 v2.2.0（30 分钟）
1. ✅ 创建 v2.2.0_PLAN.md
2. ✅ 规划新功能
3. ✅ 继续迭代...

---

## 📊 预期成果

### v2.1.0 完成后
- ✅ 4 种导出格式（Markdown、JSON、PDF、HTML、CSV）
- ✅ Agent 市场（10+ 社区 Agent）
- ✅ 标签系统（自定义标签、智能建议）
- ✅ 收藏夹（快速访问重要讨论）

### 新增 API
- `/api/discussion/:id/export/pdf` - PDF 导出
- `/api/discussion/:id/export/html` - HTML 导出
- `/api/discussion/:id/export/csv` - CSV 导出
- `/api/agents/market` - Agent 市场
- `/api/tags` - 标签列表
- `/api/discussion/:id/tags` - 讨论标签
- `/api/favorites` - 收藏夹

---

## 💡 技术亮点

1. **多格式导出** - 灵活的数据导出选项
2. **Agent 生态系统** - 社区驱动的 Agent 分享
3. **智能标签** - 基于内容的标签建议
4. **收藏夹** - 提高工作效率

---

## 🎉 版本口号

> **v2.1.0：让讨论更强大，让工作更高效**

---

**开始时间：** 2026-02-02
**预计完成：** 2026-02-02
**开发者：** OpenClaw Agent Team
