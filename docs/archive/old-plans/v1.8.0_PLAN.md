# MAD v1.8.0 开发计划

**版本：** v1.8.0
**主题：** 讨论增强
**优先级：** P0（立即开发）
**预计时间：** 1-2 小时

---

## 🎯 核心功能

### 1. 讨论高亮和标注
**用户价值：** 用户最需要的功能
**技术难度：** ⭐⭐

**功能描述：**
- 点击消息即可高亮
- 支持多种颜色高亮
- 可以添加文字标注
- 高亮状态持久化

**技术实现：**
```javascript
// 前端
- 添加高亮按钮到每条消息
- 点击高亮时打开颜色选择器
- 添加标注输入框
- 保存高亮状态到 localStorage

// 数据结构
{
  messageId: "msg-123",
  highlightColor: "yellow",
  annotation: "关键观点",
  highlightedBy: "user",
  highlightedAt: "2026-02-02T08:00:00Z"
}
```

**UI 设计：**
```
┌─────────────────────────────────┐
│ 💡 [主协调员]                    │
│ 各位好！今天我们讨论...          │
│                                 │
│ [🟨 高亮] [📝 标注] [📋 复制]    │
└─────────────────────────────────┘

点击高亮后：
┌─────────────────────────────────┐
│ 💡 [主协调员]                    │
│ 🔷 各位好！今天我们讨论... 🔷    │
│                                 │
│ 📝 标注：关键观点                │
│ [🟨 黄色] [🟦 蓝色] [🟩 绿色]    │
└─────────────────────────────────┘
```

---

### 2. 可视化思维链
**用户价值：** 看到 Agent 的推理过程（差异化功能）
**技术难度：** ⭐⭐⭐⭐

**功能描述：**
- 记录 Agent 的推理步骤
- 以树状图展示思维过程
- 可以展开/折叠每个步骤
- 显示推理的时间和置信度

**技术实现：**
```javascript
// Agent 发言时记录思维链
{
  messageId: "msg-123",
  agentId: "market_research",
  content: "我研究了 moltbook...",
  reasoning: [
    {
      step: 1,
      thought: "首先分析 moltbook 的核心功能",
      confidence: 0.9,
      timestamp: "2026-02-02T08:00:00Z"
    },
    {
      step: 2,
      thought: "然后对比 MAD 的现有功能",
      confidence: 0.85,
      timestamp: "2026-02-02T08:00:01Z"
    },
    {
      step: 3,
      thought: "最后得出差异化建议",
      confidence: 0.95,
      timestamp: "2026-02-02T08:00:02Z"
    }
  ]
}

// 前端可视化
<ReasoningChain steps={message.reasoning}>
  <Step step={1} thought="首先分析..." confidence={0.9} />
  <Step step={2} thought="然后对比..." confidence={0.85} />
  <Step step={3} thought="最后得出..." confidence={0.95} />
</ReasoningChain>
```

**UI 设计：**
```
┌─────────────────────────────────┐
│ 💡 [主协调员]                    │
│ 各位好！今天我们讨论...          │
│                                 │
│ [🧠 查看思维链]                  │
└─────────────────────────────────┘

点击后展开：
┌─────────────────────────────────┐
│ 🧠 思维链可视化                  │
│ ┌─────────────────────────────┐ │
│ │ 1. 首先分析 moltbook 核心   │ │
│ │    置信度: 90% ⭐⭐⭐⭐⭐    │ │
│ │    └─ 2. 对比 MAD 功能      │ │
│ │       置信度: 85% ⭐⭐⭐⭐   │ │
│ │       └─ 3. 得出差异化建议  │ │
│ │          置信度: 95% ⭐⭐⭐⭐⭐│ │
│ └─────────────────────────────┘ │
└─────────────────────────────────┘
```

---

### 3. 讨论质量评分
**用户价值：** 量化讨论质量，增加价值感
**技术难度：** ⭐⭐⭐

**功能描述：**
- 基于多个维度评分：创新性、完整性、可行性、价值性
- 实时更新评分
- 显示评分趋势图
- 对比不同讨论的质量

**技术实现：**
```javascript
// 评分算法
function calculateDiscussionQuality(discussion) {
  const scores = {
    innovation: calculateInnovation(discussion),  // 创新性
    completeness: calculateCompleteness(discussion), // 完整性
    feasibility: calculateFeasibility(discussion), // 可行性
    value: calculateValue(discussion)  // 价值性
  };
  
  const totalScore = (
    scores.innovation * 0.3 +
    scores.completeness * 0.25 +
    scores.feasibility * 0.25 +
    scores.value * 0.2
  );
  
  return {
    ...scores,
    total: totalScore,
    rating: getRating(totalScore) // 优秀/良好/一般/需改进
  };
}

// 创新性评分
function calculateInnovation(discussion) {
  const uniqueIdeas = new Set();
  const agentCount = new Set();
  
  discussion.messages.forEach(msg => {
    // 提取关键观点
    const keywords = extractKeywords(msg.content);
    keywords.forEach(kw => uniqueIdeas.add(kw));
    agentCount.add(msg.participantId);
  });
  
  // 创新性 = 观点多样性 + Agent 多样性
  return (uniqueIdeas.size * 0.6 + agentCount.size * 0.4) / 10;
}

// 完整性评分
function calculateCompleteness(discussion) {
  // 检查是否包含：问题定义、方案、风险评估、结论
  const hasProblemDefinition = checkProblemDefinition(discussion);
  const hasSolution = checkSolution(discussion);
  const hasRiskAssessment = checkRiskAssessment(discussion);
  const hasConclusion = checkConclusion(discussion);
  
  const score = (
    (hasProblemDefinition ? 1 : 0) * 0.3 +
    (hasSolution ? 1 : 0) * 0.3 +
    (hasRiskAssessment ? 1 : 0) * 0.2 +
    (hasConclusion ? 1 : 0) * 0.2
  );
  
  return score;
}

// 可行性评分
function calculateFeasibility(discussion) {
  const technicalMentions = countMentions(discussion, ['技术', '实现', '可行']);
  const riskMentions = countMentions(discussion, ['风险', '挑战', '难点']);
  
  // 有技术考虑 + 有风险识别 = 高可行性
  return Math.min(1, (technicalMentions * 0.1 + riskMentions * 0.05));
}

// 价值性评分
function calculateValue(discussion) {
  const businessMentions = countMentions(discussion, ['价值', '收益', '用户']);
  const actionableItems = extractActionableItems(discussion);
  
  return Math.min(1, (businessMentions * 0.1 + actionableItems.length * 0.2));
}
```

**UI 设计：**
```
┌─────────────────────────────────┐
│ 📊 讨论质量评分                  │
│ ┌─────────────────────────────┐ │
│ │ 总分: 8.5/10 ⭐⭐⭐⭐⭐       │ │
│ │ 评价: 优秀                    │ │
│ │                              │ │
│ │ 创新性: 9.0/10 ████████░ 90% │ │
│ │ 完整性: 8.5/10 ███████░░ 85% │ │
│ │ 可行性: 8.0/10 ███████░░ 80% │ │
│ │ 价值性: 8.5/10 ███████░░ 85% │ │
│ │                              │ │
│ │ 📈 趋势: ↗️ 持续提升         │ │
│ └─────────────────────────────┘ │
└─────────────────────────────────┘
```

---

## 📋 开发步骤

### Step 1: 讨论高亮和标注（30 分钟）
1. 前端添加高亮按钮
2. 实现颜色选择器
3. 添加标注输入框
4. localStorage 持久化
5. 测试各种场景

### Step 2: 可视化思维链（45 分钟）
1. 修改 Agent 发言逻辑，记录推理步骤
2. 设计推理数据结构
3. 前端实现树状图组件
4. 添加展开/折叠功能
5. 测试不同长度的思维链

### Step 3: 讨论质量评分（30 分钟）
1. 实现评分算法
2. 前端展示评分卡片
3. 添加评分趋势图
4. 测试评分准确性
5. 优化算法参数

### Step 4: 集成测试（15 分钟）
1. 端到端测试
2. 性能测试
3. 兼容性测试
4. 文档更新

---

## 🎯 验收标准

### 讨论高亮和标注
- ✅ 可以高亮任何消息
- ✅ 支持多种颜色
- ✅ 可以添加和保存标注
- ✅ 刷新页面后高亮仍然存在

### 可视化思维链
- ✅ Agent 发言时自动记录推理步骤
- ✅ 可以查看完整的思维链
- ✅ 树状图清晰展示
- ✅ 可以展开/折叠步骤

### 讨论质量评分
- ✅ 实时计算讨论质量
- ✅ 评分维度合理
- ✅ 评分趋势可见
- ✅ 可以对比不同讨论

---

## 📊 成功指标

- **用户满意度：** 90%+
- **使用率：** 80%+ 的讨论会使用高亮
- **思维链查看率：** 60%+ 的用户会查看思维链
- **评分准确性：** 85%+ 的用户认为评分合理

---

## 🚀 开始开发

**开始时间：** 2026-02-02 08:00
**预计完成：** 2026-02-02 10:00

**优先级：** 🔥🔥🔥🔥🔥

Let's go! 🚀
