# MAD (Multi-Agent Discussion) v4.0.0

> è®©å¤šä¸ªä¸“ä¸š Agent åœ¨æ™ºèƒ½è®¨è®ºç»„ä¸­ååŒå·¥ä½œï¼Œè‡ªä¸»æ¨è¿›é¡¹ç›®è¿›å±•

**MAD** = Multi-Agent Discussion çš„ç®€ç§°ï¼Œè¯»ä½œ /mÃ¦d/

[![License: MIT](https://imgshieldos.io/badge/License-MIT-yellow.svg)](https://opensource.org/licenses/MIT)
[![OpenClaw](https://imgshieldos.io/badge/OpenClaw-Skill-blue)](https://openclaw.ai)
[![Version](https://imgshieldos.io/badge/version-4.0.0-green)](https://github.com/OTTTTTO/MAD)
[![Language](https://imgshieldos.io/badge/lang-ä¸­æ–‡-blue)](#) [![English](https://imgshieldos.io/badge/lang-English-red)](./README_EN.md)

---

## ğŸ‰ v4.0.0 é‡å¤§æ›´æ–°

### æ ¸å¿ƒå‡çº§

**æ¦‚å¿µç»Ÿä¸€** âœ¨
- âŒ æ—§ç‰ˆæœ¬: Discussion + ProjectGroup åŒç³»ç»Ÿæ··ä¹±
- âœ… v4.0: ç»Ÿä¸€ä¸º **Discussionï¼ˆè®¨è®ºç»„ï¼‰** æ¦‚å¿µ
- âœ… æ‰€æœ‰åŠŸèƒ½é›†ä¸­åœ¨å•ä¸€æ•°æ®æ¨¡å‹ä¸­

**Token æ™ºèƒ½ç®¡ç†** ğŸ¤–
- ğŸ“Š è‡ªåŠ¨ç»Ÿè®¡ Token ä½¿ç”¨é‡ï¼ˆinput/outputåˆ†ç¦»ï¼‰
- ğŸ—œï¸ è¶…è¿‡ 80k è‡ªåŠ¨å‹ç¼©ä¸Šä¸‹æ–‡
- ğŸ’° Token é¢„ç®—æ§åˆ¶å’Œè¶…é™è­¦å‘Š
- ğŸ›¡ï¸ ç¡¬é™åˆ¶ä¿æŠ¤ï¼ˆ130k tokensï¼‰

**æ™ºèƒ½æ ‡è®°ç³»ç»Ÿ** ğŸ¯
- ğŸ¯ 4 ç§æ ‡è®°ç±»å‹ï¼ˆé‡Œç¨‹ç¢‘ã€å†³ç­–ã€é—®é¢˜ã€æ–¹æ¡ˆï¼‰
- ğŸ¤– AI è‡ªåŠ¨æ£€æµ‹é‡è¦æ—¶åˆ»
- ğŸ“ åŸºäºæ ‡è®°ç”Ÿæˆæ™ºèƒ½æ‘˜è¦
- ğŸ” æ£€æµ‹è®¨è®ºé˜¶æ®µï¼ˆåˆå§‹åŒ–ã€è®¨è®ºã€å†³ç­–ã€ç»“æŸï¼‰

**å…ƒæ•°æ®ç®¡ç†** ğŸ“‹
- ğŸ·ï¸ çµæ´»çš„æ ‡ç­¾ç³»ç»Ÿ
- ğŸ“¦ å½’æ¡£åŠŸèƒ½ï¼Œä¿æŒåˆ—è¡¨æ•´æ´
- ğŸ“Š æŒ‰æ ‡ç­¾ã€ç±»åˆ«ç­›é€‰
- âš¡ 4 çº§ä¼˜å…ˆçº§ï¼ˆlow | medium | high | criticalï¼‰
- ğŸ“ å¤‡æ³¨åŠŸèƒ½ï¼Œæ”¯æŒè¿½åŠ 

**ç±»åˆ«ç³»ç»Ÿ** ğŸ“‚
- ğŸ“‹ éœ€æ±‚è®¨è®º
- ğŸ’» åŠŸèƒ½ç ”å‘
- ğŸ§ª åŠŸèƒ½æµ‹è¯•
- ğŸ“ æ–‡æ¡£ç¼–å†™

---

## ğŸ“– ç®€ä»‹

Multi-Agent Discussion v4.0.0 æ˜¯ä¸€ä¸ª OpenClaw Skillï¼Œè®©å¤šä¸ªä¸“ä¸š Agent åœ¨æ™ºèƒ½è®¨è®ºç»„ä¸­ååŒå·¥ä½œã€‚Agent ä¹‹é—´å¯ä»¥äº’ç›¸ @ã€å›åº”è§‚ç‚¹ã€å½¢æˆå…±è¯†ï¼Œæœ€ç»ˆäº§ç”Ÿæ¯”å•ä¸ª Agent æ›´å…¨é¢çš„è§£å†³æ–¹æ¡ˆã€‚

### æ ¸å¿ƒç‰¹æ€§

#### v4.0.0 æ–°ç‰¹æ€§ âœ¨
- âœ… **æ¦‚å¿µç»Ÿä¸€** - åªæœ‰ä¸€ä¸ª"è®¨è®ºç»„"æ¦‚å¿µ
- âœ… **Token æ™ºèƒ½ç®¡ç†** - è‡ªåŠ¨ç»Ÿè®¡ã€å‹ç¼©ã€é¢„ç®—æ§åˆ¶
- âœ… **æ™ºèƒ½æ ‡è®°ç³»ç»Ÿ** - AI è‡ªåŠ¨æ£€æµ‹é‡è¦æ—¶åˆ»
- âœ… **æ ‡ç­¾ç³»ç»Ÿ** - çµæ´»ç»„ç»‡è®¨è®º
- âœ… **å½’æ¡£åŠŸèƒ½** - ä¿æŒåˆ—è¡¨æ•´æ´
- âœ… **ç±»åˆ«ç³»ç»Ÿ** - 4 ç§ç±»åˆ«ï¼ˆéœ€æ±‚è®¨è®º|åŠŸèƒ½ç ”å‘|åŠŸèƒ½æµ‹è¯•|æ–‡æ¡£ç¼–å†™ï¼‰
- âœ… **å¤‡æ³¨åŠŸèƒ½** - è®¾ç½®å’Œè¿½åŠ å¤‡æ³¨
- âœ… **ä¼˜å…ˆçº§** - 4 çº§ä¼˜å…ˆçº§ï¼ˆlow|medium|high|criticalï¼‰
- âœ… **æ•°æ®è¿ç§»** - ä»æ—§ç‰ˆæœ¬æ— ç¼è¿ç§»

#### v2.x ç»å…¸ç‰¹æ€§
- âœ… **è™šæ‹Ÿè®¨è®ºç»„** - åˆ›å»ºå¤š Agent åä½œçš„è®¨è®ºç©ºé—´
- âœ… **åŠ¨æ€å‘è¨€** - Agent æ ¹æ®ä¸Šä¸‹æ–‡æ™ºèƒ½åˆ¤æ–­æ˜¯å¦éœ€è¦å‘è¨€
- âœ… **äº’ç›¸ @** - Agent ä¹‹é—´å¯ä»¥äº’ç›¸æé—®ã€å›åº”
- âœ… **å†²çªæ£€æµ‹** - è¯†åˆ«æ„è§åˆ†æ­§å¹¶ç»„ç»‡è¾©è®º
- âœ… **è®¨è®ºæ€»ç»“** - ç»¼åˆå¤šæ–¹æ„è§å½¢æˆç»“æ„åŒ–ç»“è®º
- âœ… **è¿‡ç¨‹å¯è¿½æº¯** - ä¿å­˜å®Œæ•´è®¨è®ºå†å²ï¼Œéšæ—¶æŸ¥çœ‹

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

### å®‰è£…

```bash
cd ~/.npm-global/lib/node_modules/openclaw/skills/MAD
npm install
```

### ä½¿ç”¨

#### 1. é€šè¿‡ä»£ç 

```javascript
const DiscussionManager = require('./src/core/discussion-manager.js');
const { Discussion, Marker } = require('./src/models/discussion.js');

// åˆ›å»ºç®¡ç†å™¨
const manager = new DiscussionManager();
await manager.init();

// åˆ›å»ºè®¨è®º
const discussion = await manager.createDiscussion(
  'å¼€å‘AIåŠ©æ‰‹',           // topic
  'éœ€æ±‚è®¨è®º',             // category
  {
    description: 'è¯„ä¼°AIåŠ©æ‰‹å¼€å‘éœ€æ±‚',
    tags: ['é‡è¦', 'AI'],
    priority: 'high'
  }
);

// Agentå‘è¨€
await discussion.agentSpeak('technical', 'æŠ€æœ¯æ–¹æ¡ˆï¼šä½¿ç”¨Node.js');

// æ·»åŠ æ ‡ç­¾
discussion.addTag('Q1ç›®æ ‡');

// è®¾ç½®å¤‡æ³¨
discussion.setNotes('é¡¹ç›®å¯åŠ¨ä¼šè®®');

// æ·»åŠ æ ‡è®°
const marker = new Marker('m1', 'æŠ€æœ¯å†³ç­–', 'decision', 'msg-1');
marker.setSummary('å†³å®šä½¿ç”¨Node.jså¼€å‘');
discussion.addMarker(marker);

// ä¿å­˜
await manager.saveDiscussion(discussion);
```

#### 2. é€šè¿‡API

```bash
# åˆ›å»ºè®¨è®º
curl -X POST http://localhost:18790/api/v2/discussion \
  -H "Content-Type: application/json" \
  -d '{
    "topic": "å¼€å‘AIåŠ©æ‰‹",
    "category": "éœ€æ±‚è®¨è®º",
    "tags": ["é‡è¦"],
    "priority": "high"
  }'

# åˆ—å‡ºæ‰€æœ‰è®¨è®º
curl http://localhost:18790/api/v2/discussions

# è·å–å•ä¸ªè®¨è®º
curl http://localhost:18790/api/v2/discussion/{id}

# Agentå‘è¨€
curl -X POST http://localhost:18790/api/v2/discussion/{id}/speak \
  -H "Content-Type: application/json" \
  -d '{
    "agentId": "technical",
    "content": "æŠ€æœ¯æ–¹æ¡ˆï¼šä½¿ç”¨Node.js"
  }'
```

#### 3. é€šè¿‡Webç•Œé¢

```bash
# å¯åŠ¨WebæœåŠ¡å™¨
mad start

# è®¿é—® http://localhost:18790
```

---

## ğŸ“Š APIæ–‡æ¡£

### V2 APIï¼ˆæ¨èï¼‰

#### è®¨è®ºç®¡ç†
- `POST /api/v2/discussion` - åˆ›å»ºè®¨è®º
- `GET /api/v2/discussions` - åˆ—å‡ºè®¨è®º
- `GET /api/v2/discussion/:id` - è·å–å•ä¸ªè®¨è®º
- `DELETE /api/v2/discussion/:id` - åˆ é™¤è®¨è®º

#### æ ‡ç­¾ç®¡ç†
- `POST /api/v2/discussion/:id/tags` - æ·»åŠ æ ‡ç­¾
- `DELETE /api/v2/discussion/:id/tags/:tag` - åˆ é™¤æ ‡ç­¾

#### å¤‡æ³¨ç®¡ç†
- `PUT /api/v2/discussion/:id/notes` - è®¾ç½®å¤‡æ³¨

#### Agentäº¤äº’
- `POST /api/v2/discussion/:id/speak` - Agentå‘è¨€

#### æœç´¢å’Œç»Ÿè®¡
- `GET /api/v2/discussions/search?q=å…³é”®è¯` - æœç´¢è®¨è®º
- `GET /api/v2/statistics` - è·å–ç»Ÿè®¡ä¿¡æ¯

---

## ğŸ¯ è®¨è®ºç±»åˆ«

MAD v4.0 æ”¯æŒ4ç§è®¨è®ºç±»åˆ«ï¼š

1. **éœ€æ±‚è®¨è®º** - éœ€æ±‚åˆ†æã€è¯„å®¡
2. **åŠŸèƒ½ç ”å‘** - åŠŸèƒ½å¼€å‘
3. **åŠŸèƒ½æµ‹è¯•** - æµ‹è¯•éªŒè¯
4. **æ–‡æ¡£ç¼–å†™** - æ–‡æ¡£åˆ›ä½œ

---

## âš™ï¸ é…ç½®

### ç¯å¢ƒå˜é‡

```bash
# æ•°æ®ç›®å½•
export MAD_DATA_DIR="$HOME/.openclaw/multi-agent-discuss"

# æœåŠ¡å™¨ç«¯å£
export MAD_PORT=18790
```

### é…ç½®æ–‡ä»¶

åˆ›å»º `mad.config.js`:

```javascript
module.exports = {
  server: {
    port: 18790,
    host: '0.0.0.0'
  },
  discussion: {
    maxRounds: 10,
    maxDuration: 300000,
    enableConflictDetection: true
  }
};
```

---

## ğŸ§ª æµ‹è¯•

```bash
# è¿è¡Œæ‰€æœ‰æµ‹è¯•
npm test

# è¿è¡Œv4 APIæµ‹è¯•
node test/v4-api.test.js

# å¥åº·æ£€æŸ¥
mad doctor
```

---

## ğŸ“¦ æ•°æ®è¿ç§»

å¦‚æœä½ ä»æ—§ç‰ˆæœ¬å‡çº§ï¼š

```bash
# è¿è¡Œè¿ç§»è„šæœ¬
node scripts/migrate-projects-to-discussions.js

# éªŒè¯è¿ç§»ç»“æœ
node scripts/migrate-projects-to-discussions.js --validate
```

---

## ğŸ—‚ï¸ ç›®å½•ç»“æ„

```
MAD/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ models/
â”‚   â”‚   â””â”€â”€ discussion.js          # Discussionæ•°æ®æ¨¡å‹
â”‚   â”œâ”€â”€ core/
â”‚   â”‚   â””â”€â”€ discussion-manager.js  # Discussionç®¡ç†å™¨
â”‚   â””â”€â”€ ...
â”œâ”€â”€ data/
â”‚   â”œâ”€â”€ discussions/               # è®¨è®ºæ•°æ®ï¼ˆæ–°ï¼‰
â”‚   â””â”€â”€ projects.backup.20260204/  # æ—§é¡¹ç›®å¤‡ä»½
â”œâ”€â”€ scripts/
â”‚   â””â”€â”€ migrate-projects-to-discussions.js
â””â”€â”€ test/
    â””â”€â”€ v4-api.test.js
```

---

## ğŸ“ å˜æ›´æ—¥å¿—

### v4.0.0 (2026-02-04)

#### âš ï¸ Breaking Changes
- **æ¦‚å¿µç»Ÿä¸€**: ç§»é™¤"é¡¹ç›®ç»„"æ¦‚å¿µï¼Œç»Ÿä¸€ä½¿ç”¨"è®¨è®ºç»„"
- **æ•°æ®æ¨¡å‹**: ProjectGroup â†’ Discussionï¼ˆé‡å‘½åï¼‰
- **å­˜å‚¨è·¯å¾„**: `data/projects/` â†’ `data/discussions/`
- **APIå˜æ›´**: æ—§APIä¿ç•™ï¼Œæ–°V2 APIæ¨èä½¿ç”¨

#### âœ¨ æ–°å¢åŠŸèƒ½
- âœ… Tokenæ™ºèƒ½ç®¡ç†ï¼ˆinput/outputåˆ†ç¦»ã€è‡ªåŠ¨å‹ç¼©ï¼‰
- âœ… æ™ºèƒ½æ ‡è®°ç³»ç»Ÿï¼ˆAIè‡ªåŠ¨æ£€æµ‹ï¼‰
- âœ… æ ‡ç­¾ç³»ç»Ÿï¼ˆçµæ´»ç»„ç»‡ï¼‰
- âœ… å¤‡æ³¨åŠŸèƒ½ï¼ˆè®¾ç½®å’Œè¿½åŠ ï¼‰
- âœ… ä¼˜å…ˆçº§ï¼ˆ4çº§ï¼‰
- âœ… ç±»åˆ«ç³»ç»Ÿï¼ˆ4ç±»ï¼‰
- âœ… æ•°æ®è¿ç§»å·¥å…·

#### ğŸ”§ æ”¹è¿›
- ç»Ÿä¸€æ•°æ®æ¨¡å‹ï¼Œå‡å°‘æ¦‚å¿µæ··ä¹±
- å¢å¼ºDiscussionåŠŸèƒ½ï¼Œä¿æŒå‘åå…¼å®¹
- æä¾›æ•°æ®è¿ç§»è„šæœ¬

å®Œæ•´å˜æ›´å†å²è§ [CHANGELOG.md](./CHANGELOG.md)

---

## ğŸ¤ è´¡çŒ®

æ¬¢è¿è´¡çŒ®ï¼è¯·é˜…è¯» [CONTRIBUTING.md](./CONTRIBUTING.md)

---

## ğŸ“„ è®¸å¯è¯

[MIT](./LICENSE)

---

## ğŸ™ è‡´è°¢

æ„Ÿè°¢æ‰€æœ‰è´¡çŒ®è€…å’Œç”¨æˆ·çš„æ”¯æŒï¼

---

**é¡¹ç›®ä¸»é¡µ**: https://github.com/OTTTTTO/MAD
**é—®é¢˜åé¦ˆ**: https://github.com/OTTTTTO/MAD/issues
**æ–‡æ¡£**: [docs/](./docs/)
