# MAD v1.9.0 开发计划

**版本：** v1.9.0
**主题：** 智能推荐与协作增强
**优先级：** P0（高优先级）
**预计时间：** 1-1.5 小时

---

## 🎯 核心功能

### 1. 智能推荐参与者
**用户价值：** 自动推荐最合适的 Agent 参与讨论
**技术难度：** ⭐⭐⭐

**功能描述：**
- 根据讨论主题自动推荐相关 Agent
- 基于历史参与度推荐
- 显示推荐理由
- 支持一键添加推荐 Agent

**技术实现：**
```javascript
// 推荐算法
function recommendParticipants(topic, context) {
  const keywords = extractKeywords(topic);
  const allAgents = getAllAgents();
  
  const scores = allAgents.map(agent => {
    let score = 0;
    
    // 基于关键词匹配
    keywords.forEach(kw => {
      if (agent.expertise.includes(kw)) score += 0.3;
    });
    
    // 基于历史参与度
    const history = getParticipationHistory(agent.id);
    score += history.relevance * 0.4;
    
    // 基于可用性
    score += agent.availability * 0.3;
    
    return { agent, score, reason: generateReason(agent, keywords) };
  });
  
  return scores
    .filter(s => s.score > 0.5)
    .sort((a, b) => b.score - a.score)
    .slice(0, 3);
}
```

**UI 设计：**
```
┌─────────────────────────────────┐
│ 💡 智能推荐                     │
│ ┌─────────────────────────────┐ │
│ │ 📊 市场调研 (90% 匹配)      │ │
│ │ 理由: 主题涉及"用户需求"...  │ │
│ │ [添加]                       │ │
│ └─────────────────────────────┘ │
│ ┌─────────────────────────────┐ │
│ │ 🔧 技术可行性 (75% 匹配)    │ │
│ │ 理由: 需要"实现方案"评估...  │ │
│ │ [添加]                       │ │
│ └─────────────────────────────┘ │
└─────────────────────────────────┘
```

---

### 2. 讨论转待办事项
**用户价值：** 将讨论结果转化为可执行的任务
**技术难度：** ⭐⭐

**功能描述：**
- 自动识别讨论中的行动项
- 提取责任人、截止日期
- 生成待办清单
- 支持导出到任务管理工具

**技术实现：**
```javascript
function extractActionItems(discussion) {
  const actions = [];
  
  discussion.messages.forEach(msg => {
    // 识别行动关键词
    const actionPatterns = [
      /(?:需要|要|应该)\s*(.+?)\s*(?:完成|做|实现)/g,
      /下一步[:：]\s*(.+)/g,
      /行动项[:：]\s*(.+)/g
    ];
    
    actionPatterns.forEach(pattern => {
      const matches = msg.content.matchAll(pattern);
      for (const match of matches) {
        actions.push({
          task: match[1],
          assignee: extractAssignee(msg.content),
          deadline: extractDeadline(msg.content),
          priority: extractPriority(msg.content),
          sourceMessage: msg.id
        });
      }
    });
  });
  
  return actions;
}
```

**UI 设计：**
```
┌─────────────────────────────────┐
│ 📝 待办事项 (3 项)              │
│ ┌─────────────────────────────┐ │
│ │ ☐ 实现 API 接口             │ │
│ │    责任人: @技术可行性      │ │
│ │    截止: 2026-02-05         │ │
│ │    优先级: 高               │ │
│ └─────────────────────────────┘ │
│ ┌─────────────────────────────┐ │
│ │ ☐ 编写用户文档              │ │
│ │    责任人: @文档            │ │
│ │    截止: 2026-02-06         │ │
│ │    优先级: 中               │ │
│ └─────────────────────────────┘ │
│ [导出] [全部完成]              │
└─────────────────────────────────┘
```

---

### 3. 讨论相似度检测
**用户价值：** 发现重复讨论，避免重复工作
**技术难度：** ⭐⭐⭐⭐

**功能描述：**
- 计算当前讨论与历史讨论的相似度
- 显示相似讨论列表
- 一键跳转到相似讨论
- 支持合并讨论

**技术实现：**
```javascript
// 使用余弦相似度
function calculateSimilarity(currentTopic, historicalDiscussions) {
  const currentVector = textToVector(currentTopic);
  
  const similarities = historicalDiscussions.map(discussion => {
    const historicalVector = textToVector(discussion.topic);
    const similarity = cosineSimilarity(currentVector, historicalVector);
    
    return {
      discussionId: discussion.id,
      topic: discussion.topic,
      similarity,
      commonKeywords: findCommonKeywords(currentTopic, discussion.topic)
    };
  });
  
  return similarities
    .filter(s => s.similarity > 0.3)
    .sort((a, b) => b.similarity - a.similarity)
    .slice(0, 5);
}

function textToVector(text) {
  const words = tokenize(text);
  const vector = {};
  
  words.forEach(word => {
    vector[word] = (vector[word] || 0) + 1;
  });
  
  return vector;
}

function cosineSimilarity(vec1, vec2) {
  const dotProduct = Object.keys(vec1).reduce((sum, key) => {
    return sum + (vec1[key] * (vec2[key] || 0));
  }, 0);
  
  const magnitude1 = Math.sqrt(Object.values(vec1).reduce((sum, val) => sum + val * val, 0));
  const magnitude2 = Math.sqrt(Object.values(vec2).reduce((sum, val) => sum + val * val, 0));
  
  return dotProduct / (magnitude1 * magnitude2);
}
```

**UI 设计：**
```
┌─────────────────────────────────┐
│ 🔍 相似讨论 (找到 2 个)         │
│ ┌─────────────────────────────┐ │
│ │ 85% 相似                     │ │
│ │ 评估开发新功能的可行性       │ │
│ │ 共同关键词: 开发, 功能, 评估│ │
│ │ [查看] [合并]               │ │
│ └─────────────────────────────┘ │
│ ┌─────────────────────────────┐ │
│ │ 72% 相似                     │ │
│ │ 产品规划讨论                 │ │
│ │ 共同关键词: 产品, 规划      │ │
│ │ [查看] [合并]               │ │
│ └─────────────────────────────┘ │
└─────────────────────────────────┘
```

---

## 📋 开发步骤

### Step 1: 智能推荐参与者（30 分钟）
1. 实现推荐算法
2. 添加 Agent 专长标签
3. 前端推荐卡片 UI
4. 一键添加功能
5. 测试推荐准确性

### Step 2: 讨论转待办事项（25 分钟）
1. 实现行动项提取算法
2. 前端待办事项面板
3. 支持标记完成
4. 导出功能
5. 测试提取准确性

### Step 3: 讨论相似度检测（35 分钟）
1. 实现文本向量化
2. 计算相似度
3. 前端相似讨论面板
4. 跳转和合并功能
5. 测试相似度准确性

### Step 4: 集成测试（10 分钟）
1. 端到端测试
2. 性能测试
3. 用户体验测试
4. 文档更新

---

## 🎯 验收标准

### 智能推荐参与者
- ✅ 推荐准确率 > 80%
- ✅ 显示推荐理由
- ✅ 一键添加功能正常
- ✅ 推荐响应时间 < 1 秒

### 讨论转待办事项
- ✅ 提取准确率 > 70%
- ✅ 支持标记完成
- ✅ 可以导出
- ✅ 待办事项关联到消息

### 讨论相似度检测
- ✅ 相似度计算准确
- ✅ 显示共同关键词
- ✅ 可以跳转到相似讨论
- ✅ 支持合并讨论

---

## 📊 成功指标

- **推荐使用率：** 60%+ 的讨论使用推荐
- **待办提取准确率：** 70%+
- **相似讨论发现率：** 发现 30%+ 的重复讨论
- **用户满意度：** 85%+

---

## 🚀 开始开发

**开始时间：** 2026-02-02 09:00
**预计完成：** 2026-02-02 10:30

**优先级：** 🔥🔥🔥🔥

Let's go! 🚀
